{% include "Header.php.twig" %}

namespace {{ skeletonModel.namespace }};

use {{ skeletonModel.deleteEntityUseCaseRequestClassName }};
use {{ skeletonModel.deleteEntityUseCaseClassName }};
use {{ skeletonModel.deleteEntityUseCaseRequestBuilderImplClassName }};
use {{ skeletonModel.deleteEntityUseCaseRequestDTOClassName }};
use {{ skeletonModel.entityStubClassName }};
use {{ skeletonModel.inMemoryEntityGatewayClassName }};
use PHPUnit\Framework\TestCase;

final class {{ skeletonModel.shortName }} extends TestCase
{
    /**
     * @var {{ skeletonModel.deleteEntityUseCaseRequestDTOShortName }}
     */
    private $request;

    /**
     * @var {{ skeletonModel.deleteEntityUseCaseShortName }}
     */
    private $useCase;

    /**
     * @test
     * @expectedException \{{ skeletonModel.entityNotFoundExceptionClassName }}
     */
    public function {{ skeletonModel.entityArgument }}NotFoundThrowException(): void
    {
        $this->request->{{ skeletonModel.entityIdArgument }} = -1;
        $this->useCase->execute($this->request);
    }

    /**
     * @test
     */
    public function {{ skeletonModel.deleteEntityUseCaseMethod }}(): void
    {
        $this->assertNotEmpty({{ skeletonModel.inMemoryEntityGatewayShortName }}::${{ skeletonModel.entitiesArgument }});
        $this->useCase->execute($this->request);

        $this->assertEmpty({{ skeletonModel.inMemoryEntityGatewayShortName }}::${{ skeletonModel.entitiesArgument }});
    }

    protected function setUp(): void
    {
        ${{ skeletonModel.entityStubsArgument }} = [{{ skeletonModel.entityStubShortName }}::ID => new {{ skeletonModel.entityStubShortName }}()];
        $this->request = $this->buildRequest();
        $this->useCase = new {{ skeletonModel.deleteEntityUseCaseShortName }}(new {{ skeletonModel.inMemoryEntityGatewayShortName }}(${{ skeletonModel.entityStubsArgument }}));
    }

    private function buildRequest(): {{ skeletonModel.deleteEntityUseCaseRequestShortName }}
    {
        return (new {{ skeletonModel.deleteEntityUseCaseRequestBuilderImplShortName }}())
            ->create()
            ->{{ skeletonModel.withEntityIdMethod }}({{ skeletonModel.entityStubShortName }}::ID)
            ->build();
    }
}
