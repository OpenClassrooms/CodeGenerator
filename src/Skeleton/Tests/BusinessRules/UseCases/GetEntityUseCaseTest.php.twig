{% include "Header.php.twig" %}

namespace {{ skeletonModel.namespace }};

use {{ skeletonModel.getEntityUseCaseRequestClassName }};
use {{ skeletonModel.getEntityUseCaseRequestBuilderImplClassName }};
use {{ skeletonModel.getEntityUseCaseRequestDTOClassName }};
use {{ skeletonModel.getEntityUseCaseClassName }};
use {{ skeletonModel.entityStubClassName }};
use {{ skeletonModel.inMemoryEntityGatewayClassName }};
use {{ skeletonModel.useCaseDetailResponseAssemblerMockClassName }};
use {{ skeletonModel.useCaseDetailResponseStubClassName }};
use {{ skeletonModel.useCaseDetailResponseTestCaseClassName }};
use PHPUnit\Framework\TestCase;

/**
 * @author {{ author }} <{{ authorEmail }}>
 */
class {{ skeletonModel.shortName }} extends TestCase
{
    use {{ skeletonModel.useCaseDetailResponseTestCaseShortName }};

    const INVALID_ID = -1;

    /**
     * @var {{ skeletonModel.getEntityUseCaseRequestDTOShortName }}
     */
    private $request;

    /**
     * @var {{ skeletonModel.getEntityUseCaseShortName }}
     */
    private $useCase;

    /**
     * @test
     *
     * @expectedException \{{ skeletonModel.entityNotFoundExceptionFileObjectClassName }}
     */
    public function {{ skeletonModel.entityShortNameArgument }}NotFoundShouldThrowException()
    {
        $this->request->id = self::INVALID_ID;
        $this->useCase->execute($this->request);
    }

    /**
     * @test
     */
    public function get{{ skeletonModel.entityShortName }}ShouldReturnResponse()
    {
        $response = $this->useCase->execute($this->request);

        $this->assert{{ skeletonModel.entityShortName }}DetailResponse(new {{ skeletonModel.useCaseDetailResponseStubShortName }}(), $response);

        $this->fail("TODO: configure stub");
    }

    protected function setup()
    {
        $this->useCase = new {{ skeletonModel.getEntityUseCaseShortName }}();
        $this->useCase->set{{ skeletonModel.entityShortName }}Gateway(
            new {{ skeletonModel.inMemoryEntityGatewayShortName }}([{{ skeletonModel.entityStubShortName }}::ID => new {{ skeletonModel.entityStubShortName }}()])
        );
        $this->useCase->set{{ skeletonModel.entityShortName }}ResponseAssembler(new {{ skeletonModel.useCaseDetailResponseAssemblerMockShortName }}());
        $this->request = $this->buildRequest();
    }

    private function buildRequest(): {{ skeletonModel.getEntityUseCaseRequestShortName }}
    {
        $builder = new {{ skeletonModel.getEntityUseCaseRequestBuilderImplShortName }}();

        return $builder
            ->create()
            ->with{{ skeletonModel.entityShortName }}Id({{ skeletonModel.entityStubShortName }}::ID)
            ->build();
    }
}
